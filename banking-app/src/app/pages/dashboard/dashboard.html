<div class="dashboard-container">
  <!-- üîπ Fraud Alert Banner -->
  <div class="fraud-banner" *ngIf="fraudAlert">
    üö® {{ fraudAlert }}
    <button class="close-btn" (click)="fraudAlert = null">‚úñ</button>
  </div>

  <!-- üîπ Top Navbar -->
  <header class="navbar">
    <div class="logo">üè¶ <span>Banking Website</span></div>
    <nav class="nav-links">
      <a href="#">Home</a>
      <a href="#">Services</a>
      <a href="#">Support</a>
    </nav>
    <div class="profile">
      <span class="username">Hi, {{ fullName }}</span>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>
  </header>

  <!-- üîπ Dashboard Content -->
  <main class="dashboard-main">
    <!-- Balance + Chart Row -->
    <section class="top-row">
      <!-- Account Balance Card -->
      <div class="balance-card card">
        <h2>Account Balance</h2>
        <p class="balance-amount">${{ accounts[0]?.balance || 0 }}</p>
        <button class="transaction-btn" (click)="openTransactionDialog()">
          + New Transaction
        </button>
      </div>

      <!-- Spending Breakdown Chart -->
      <div class="chart-card card">
        <h3>Spending Breakdown</h3>
        <div class="chart-wrapper">
          <canvas
            baseChart
            [data]="chartData"
            [options]="chartOptions"
            chartType="pie"
          >
          </canvas>
        </div>
      </div>
    </section>

    <!-- Transactions Table -->
    <section class="transactions-card card">
      <h3>Recent Transactions</h3>
      <div class="table-wrapper">
        <table
          class="transactions-table"
          *ngIf="transactions.length > 0; else noTx"
        >
          <thead>
            <tr>
              <th>Date</th>
              <th>Description</th>
              <th>Type</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Probability</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tx of transactions">
              <td>{{ tx.timestamp | date: "short" }}</td>
              <td>{{ tx.description }}</td>
              <td
                [ngClass]="{
                  credit: tx.type === 'Credit',
                  debit: tx.type === 'Debit'
                }"
              >
                {{ tx.type }}
              </td>
              <td
                [ngClass]="{
                  credit: tx.type === 'Credit',
                  debit: tx.type === 'Debit'
                }"
              >
                {{ tx.type === "Credit" ? "+" : "-" }} ${{ tx.amount }}
              </td>
              <td
                [ngClass]="{
                  fraud: tx.predictedLabel,
                  safe: !tx.predictedLabel
                }"
              >
                {{ tx.predictedLabel ? "üö® Fraud" : "‚úÖ Safe" }}
              </td>
              <td>{{ (tx.probability * 100) | number: "1.0-2" }}%</td>
            </tr>
          </tbody>
        </table>
        <ng-template #noTx>
          <p class="no-transactions">No transactions found.</p>
        </ng-template>
      </div>
    </section>
  </main>
</div>

<!-- üîπ Transaction Dialog Modal -->
<div class="transaction-dialog" *ngIf="showTransactionDialog">
  <div class="dialog-content">
    <h3>New Transaction</h3>
    <form (ngSubmit)="submitTransaction()">
      <label>Amount</label>
      <input type="number" [(ngModel)]="newTransaction.amount" name="amount" required />

      <label>Type</label>
      <select [(ngModel)]="newTransaction.type" name="type" required>
        <option value="Credit">Credit</option>
        <option value="Debit">Debit</option>
      </select>

      <label>Description</label>
      <input type="text" [(ngModel)]="newTransaction.description" name="description" />

      <label>Channel</label>
      <select [(ngModel)]="newTransaction.channel" name="channel">
        <option value="Web">Web</option>
        <option value="Mobile">Mobile</option>
        <option value="ATM">ATM</option>
      </select>

      <div class="dialog-actions">
        <button type="submit">Submit</button>
        <button type="button" (click)="closeTransactionDialog()">Cancel</button>
      </div>
    </form>
  </div>
</div>
